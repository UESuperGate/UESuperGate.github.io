<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Construct Ethereum Private Chain and Debug Locally · SuperGate</title><meta name="description" content="Construct Ethereum Private Chain and Debug Locally - SuperGate"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/avator.jpg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://example.com/atom.xml" title="SuperGate"><meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="SuperGate" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/avator.jpg" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/aboutme/" target="_self" class="nav-list-link">ABOUTME</a></li><li class="nav-list-item"><a href="/friends/" target="_self" class="nav-list-link">FRIENDS</a></li><li class="nav-list-item"><a href="https://github.com/UESuperGate" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Construct Ethereum Private Chain and Debug Locally</h1><div class="post-info">May 6, 2021</div><div class="post-content"><!-- toc -->

<ul>
<li><a href="#references">References</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#build-private-chain-by-geth">Build Private Chain by Geth</a></li>
<li><a href="#how-to-play-with-it">How to Play with it</a><ul>
<li><a href="#send-transaction">Send Transaction</a></li>
<li><a href="#deploy-a-contract">Deploy a Contract</a></li>
<li><a href="#to-be-continued">to be continued…</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

<h1><span id="references">References</span></h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/wo541075754/article/details/98847308">https://blog.csdn.net/wo541075754/article/details/98847308</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/33865441">https://zhuanlan.zhihu.com/p/33865441</a></p>
<p><a target="_blank" rel="noopener" href="https://learnblockchain.cn/2019/04/08/genesis">https://learnblockchain.cn/2019/04/08/genesis</a></p>
<p><a target="_blank" rel="noopener" href="https://web3py.readthedocs.io/en/stable/">https://web3py.readthedocs.io/en/stable/</a></p>
<h1><span id="installation">Installation</span></h1><p>I’d like to install Ethereum from source, because it’s more easy and I can get the latest version.</p>
<p>According to the <code>README.md</code>, you may need to install Go (version 1.14 or later) and a C compiler first.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/ethereum/go-ethereum.git</span><br><span class="line">cd go-ethereum</span><br><span class="line">make geth</span><br></pre></td></tr></table></figure>
<p>The output will be in <code>go-ethereum/build/bin/</code> by default.</p>
<p>If you want to install in a different way, please refer to <a target="_blank" rel="noopener" href="https://geth.ethereum.org/docs/install-and-build/installing-geth">this</a>.</p>
<h1><span id="build-private-chain-by-geth">Build Private Chain by Geth</span></h1><p>We can modify the configuration of our own chain so that it will be more easy for us to debug the smart contract deployed and to trace each transaction.</p>
<p>We need to create a new directory to be the main workspace, and we need to create <code>genesis.json</code> in this directory before building the first block.</p>
<p><strong>genesis.json</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    <span class="attr">&quot;config&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;chainId&quot;</span>: <span class="number">15</span>,</span><br><span class="line">        <span class="attr">&quot;homesteadBlock&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;eip150Block&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;eip155Block&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;eip158Block&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;coinbase&quot;</span> : <span class="string">&quot;0x0000000000000000000000000000000000000000&quot;</span>, <span class="comment">// The address of the account that gets the reward by default</span></span><br><span class="line">    <span class="attr">&quot;difficulty&quot;</span> : <span class="string">&quot;0x1&quot;</span>, <span class="comment">// Difficulty of mining</span></span><br><span class="line">    <span class="attr">&quot;extraData&quot;</span> : <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;gasLimit&quot;</span> : <span class="string">&quot;0xffffffff&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;nonce&quot;</span> : <span class="string">&quot;0x0000000000000042&quot;</span>, <span class="comment">// Random number</span></span><br><span class="line">    <span class="attr">&quot;mixhash&quot;</span> : <span class="string">&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;</span>, <span class="comment">// Related to PoW</span></span><br><span class="line">    <span class="attr">&quot;parentHash&quot;</span> : <span class="string">&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;</span>, <span class="comment">// The parent node hash value. For the first block, it should be 0</span></span><br><span class="line">    <span class="attr">&quot;timestamp&quot;</span> : <span class="string">&quot;0x00&quot;</span>, <span class="comment">// UTC timestamp</span></span><br><span class="line">    <span class="attr">&quot;alloc&quot;</span>: &#123; &#125; <span class="comment">// When the blockchain is generated, these accounts are given certain assets in advance</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Run the command below to initialize.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geth --datadir &quot;./&quot; init genesis.json</span><br></pre></td></tr></table></figure>
<h1><span id="how-to-play-with-it">How to Play with it</span></h1><p>First we should notice that if we run the command like:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geth --datadir &quot;./&quot; --nodiscover --rpc --rpcaddr 127.0.0.1 --rpcport 7050 --rpcapi &quot;debug,eth,net,web3,miner,personal&quot; --networkid 10 console 2&gt;&gt;eth_log.log</span><br></pre></td></tr></table></figure>
<p>There will be error when we trying to unlock an account:<br><img src="pic1.png"></p>
<p>This is because in the new version of geth, to keep secure, the HTTP channel unlocking account is disabled by default. We can refer <a target="_blank" rel="noopener" href="https://github.com/ethereum/go-ethereum/pull/17037">this issue</a> from github.</p>
<p>If we just want to debug on our private chain, this may work (simply adding <code>--allow-insecure-unlock</code>):</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geth --datadir &quot;./&quot; --nodiscover --rpc --rpcaddr 127.0.0.1 --rpcport 7050 --rpcapi &quot;debug,eth,net,web3,miner,personal&quot; --networkid 10 --allow-insecure-unlock  console 2&gt;&gt;eth_log.log</span><br></pre></td></tr></table></figure>
<h2><span id="send-transaction">Send Transaction</span></h2><p>We can try to create 2 accounts to make transaction.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> personal.newAccount(<span class="string">&quot;aaa&quot;</span>)</span></span><br><span class="line">&quot;0x5d31e74f0e52fe3fd58bd8079f84bc601a3f6d89&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> personal.newAccount(<span class="string">&quot;bbb&quot;</span>)</span></span><br><span class="line">&quot;0xd14a5c1ca1299d003284483b77b789e28a50741f&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> eth.accounts</span></span><br><span class="line">[&quot;0x5d31e74f0e52fe3fd58bd8079f84bc601a3f6d89&quot;, &quot;0xd14a5c1ca1299d003284483b77b789e28a50741f&quot;]</span><br></pre></td></tr></table></figure>
<p>Let’s presume that <code>0x5d31e74f0e52fe3fd58bd8079f84bc601a3f6d89</code> has some ethereum, so if he want to send his ethereum to another account, we should unlock first.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> personal.unlockAccount(eth.accounts[0])</span></span><br><span class="line">Unlock account 0x5d31e74f0e52fe3fd58bd8079f84bc601a3f6d89</span><br><span class="line">Passphrase:</span><br><span class="line">true</span><br></pre></td></tr></table></figure>
<p>Now we can try to send trasaction.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> eth.getBalance(eth.accounts[0])</span></span><br><span class="line">624999999999959999600</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> eth.getBalance(eth.accounts[1])</span></span><br><span class="line">40000400</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> eth.sendTransaction(&#123;from: eth.accounts[0], to: eth.accounts[1], value: 20000000&#125;)</span></span><br><span class="line">&quot;0xe8cba28afecd5d8516096ccce7e18ae186ceea9e3d40ae8411412c7dc34e9695&quot;</span><br></pre></td></tr></table></figure>
<p>Seems like it works! Let’s check their balance again:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> eth.getBalance(eth.accounts[0])</span></span><br><span class="line">624999999999959999600</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> eth.getBalance(eth.accounts[1])</span></span><br><span class="line">40000400</span><br></pre></td></tr></table></figure>
<p>It’s weird! Both balance don’t change at all!</p>
<p>Actually, the transaction do have been commited to the blockchain, but has not been handled:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> txpool.status</span></span><br><span class="line">&#123;</span><br><span class="line">  pending: 1,</span><br><span class="line">  queued: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>To make the transaction been processed, it must be mined. So we start mining, and then wait for a block to be mined, then stop mining.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> miner.start(1)</span></span><br><span class="line">null</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> eth.getBalance(eth.accounts[0])</span></span><br><span class="line">654999999999939999600</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> eth.getBalance(eth.accounts[1])</span></span><br><span class="line">60000400</span><br></pre></td></tr></table></figure>
<p>Done!</p>
<h2><span id="deploy-a-contract">Deploy a Contract</span></h2><p>Sometimes we need to deploy a smart contract on our own chain in order to debug, and we need to check a certain transaction detail after the transacton is done. It’s convenient for us to use the APIs from <code>web3py</code> to do them all.</p>
<p>Installing <code>web3py</code>:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install web3</span><br></pre></td></tr></table></figure>
<p>In the entire Ethereum network, the service we start through <code>geth</code> can be called a <code>node</code>, and <code>rpc</code> (which we have already included in the starting command) protocol can be used to send RPC operations to the node, and to receive data from the nodes. Using <code>web3</code>, it can be simply like this:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> web3 <span class="keyword">import</span> Web3</span><br><span class="line"></span><br><span class="line">w3 = Web3(Web3.HTTPProvider(<span class="string">&quot;http://127.0.0.1:7050&quot;</span>))</span><br><span class="line">print(w3.isConnected())</span><br></pre></td></tr></table></figure>
<p>In this case only, we use <code>http://127.0.0.1:7050</code> to connect to our node (just as the parameters <code>--rpc --rpcaddr 127.0.0.1 --rpcport 7050</code> stated). And if the output is <code>true</code>, we have successfully connected to our node.</p>
<p>There are more RPC methods to connect, according to the circumstances, you can choose one the most suitable for yourself:</p>
<ul>
<li>IPCProvider</li>
<li>HTTPProvider</li>
<li>Auto check</li>
<li>…</li>
</ul>
<p>And how can we deploy the contract on the node? Some APIs from <code>web3py</code> also work. First you need to compile your contract on <code>Remix</code> to get its <code>bytecode</code> and <code>ABI</code>. Using command <code>solc</code> in console to get them is also OK.</p>
<p><img src="pic2.png"></p>
<p>For instance, If we want to call a function from a contract, the python code should be like this (The solidity source code is from <a target="_blank" rel="noopener" href="https://ainevsia.github.io/2021/03/22/balsnctf2019-bank/">BalsnCTF 2019 Bank</a>):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> web3 <span class="keyword">import</span> Web3</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> web3.types <span class="keyword">import</span> TxReceipt</span><br><span class="line"></span><br><span class="line">w3 = Web3(Web3.HTTPProvider(<span class="string">&quot;http://127.0.0.1:7050&quot;</span>))</span><br><span class="line">w3.isConnected()</span><br><span class="line"></span><br><span class="line">_bytecode = <span class="string">&quot;0x60806040526001805534801561001457600080fd5b50336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550610b52806100646000396000f300608060405260043610610057576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680631ec612411461005c5780638da5cb5b1461009d578063ed0242cf146100f4575b600080fd5b61009b60048036038101908080359060200190929190803573ffffffffffffffffffffffffffffffffffffffff1916906020019092919050505061013f565b005b3480156100a957600080fd5b506100b26101c6565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b610129600480360381019080803573ffffffffffffffffffffffffffffffffffffffff191690602001909291905050506101eb565b6040518082815260200191505060405180910390f35b600060028381548110151561015057fe5b906000526020600020906002020190508060000160009054906101000a900460ff1615151561017e57600080fd5b6101a483838360000160019054906101000a900467ffffffffffffffff1663ffffffff16565b60018160000160006101000a81548160ff021916908315150217905550505050565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60008060008160000160006101000a81548160ff021916908315150217905550828160000160096101000a8154816bffffffffffffffffffffffff021916908374010000000000000000000000000000000000000000900402179055503481600101819055506000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614156102d8576104548160000160016101000a81548167ffffffffffffffff021916908367ffffffffffffffff160217905550610336565b670de0b6b3a764000034101515156102ef57600080fd5b662386f26fc1000081600101600082825403925050819055506107b38160000160016101000a81548167ffffffffffffffff021916908367ffffffffffffffff1602179055505b600281908060018154018082558091505090600182039060005260206000209060020201600090919290919091506000820160009054906101000a900460ff168160000160006101000a81548160ff0219169083151502179055506000820160019054906101000a900467ffffffffffffffff168160000160016101000a81548167ffffffffffffffff021916908367ffffffffffffffff1602179055506000820160099054906101000a900474010000000000000000000000000000000000000000028160000160096101000a8154816bffffffffffffffffffffffff0219169083740100000000000000000000000000000000000000009004021790555060018201548160010155505050600160028054905003915050919050565b8181600060028381548110151561046757fe5b906000526020600020906002020160000160099054906101000a9004740100000000000000000000000000000000000000000273ffffffffffffffffffffffffffffffffffffffff191682604051808273ffffffffffffffffffffffffffffffffffffffff191673ffffffffffffffffffffffffffffffffffffffff19168152600c01915050604051809103902073ffffffffffffffffffffffffffffffffffffffff19161415156106f557828160000181905550428160010181905550818160020160006101000a8154816bffffffffffffffffffffffff021916908374010000000000000000000000000000000000000000900402179055503281600201600c6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819080600181540180825580915050906001820390600052602060002090600302016000909192909190915060008201548160000155600182015481600101556002820160009054906101000a900474010000000000000000000000000000000000000000028160020160006101000a8154816bffffffffffffffffffffffff0219169083740100000000000000000000000000000000000000009004021790555060028201600c9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681600201600c6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505050506107ac565b6a52b7d2dcc80cd2e4000000341015151561070f57600080fd5b7f2d3bd82a572c860ef85a36e8d4873a9deed3f76b9fddbf13fbe4fe8a97c4a57933604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390a16000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b5050505050565b818160006002838154811015156107c657fe5b906000526020600020906002020160000160099054906101000a9004740100000000000000000000000000000000000000000273ffffffffffffffffffffffffffffffffffffffff191682604051808273ffffffffffffffffffffffffffffffffffffffff191673ffffffffffffffffffffffffffffffffffffffff19168152600c01915050604051809103902073ffffffffffffffffffffffffffffffffffffffff1916141515610a5457828160000181905550428160010181905550818160020160006101000a8154816bffffffffffffffffffffffff021916908374010000000000000000000000000000000000000000900402179055503281600201600c6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819080600181540180825580915050906001820390600052602060002090600302016000909192909190915060008201548160000155600182015481600101556002820160009054906101000a900474010000000000000000000000000000000000000000028160020160006101000a8154816bffffffffffffffffffffffff0219169083740100000000000000000000000000000000000000009004021790555060028201600c9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681600201600c6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550505050610b1f565b3373ffffffffffffffffffffffffffffffffffffffff166108fc600287815481101515610a7d57fe5b9060005260206000209060020201600101549081150290604051600060405180830381858888f19350505050158015610aba573d6000803e3d6000fd5b507f52a051bca553b0a466ddf55904bf9b9a11c8234e4b8c33f40bf79749a8df067033604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390a15b50505050505600a165627a7a72305820ae68ace0c29a463c9b37bcd9d83993367624020a5247116238bf07b4e209a5f10029&quot;</span></span><br><span class="line">_abi_json = <span class="string">&#x27;[&#123;&quot;constant&quot;: false,&quot;inputs&quot;: [&#123;&quot;name&quot;: &quot;idx&quot;,&quot;type&quot;: &quot;uint256&quot;&#125;,&#123;&quot;name&quot;: &quot;pass&quot;,&quot;type&quot;: &quot;bytes12&quot;&#125;],&quot;name&quot;: &quot;withdraw&quot;,&quot;outputs&quot;: [],&quot;payable&quot;: true,&quot;stateMutability&quot;: &quot;payable&quot;,&quot;type&quot;: &quot;function&quot;&#125;,&#123;&quot;constant&quot;: true,&quot;inputs&quot;: [],&quot;name&quot;: &quot;owner&quot;,&quot;outputs&quot;: [&#123;&quot;name&quot;: &quot;&quot;,&quot;type&quot;: &quot;address&quot;&#125;],&quot;payable&quot;: false,&quot;stateMutability&quot;: &quot;view&quot;,&quot;type&quot;: &quot;function&quot;&#125;,&#123;&quot;constant&quot;: false,&quot;inputs&quot;: [&#123;&quot;name&quot;: &quot;hash&quot;,&quot;type&quot;: &quot;bytes12&quot;&#125;],&quot;name&quot;: &quot;deposit&quot;,&quot;outputs&quot;: [&#123;&quot;name&quot;: &quot;&quot;,&quot;type&quot;: &quot;uint256&quot;&#125;],&quot;payable&quot;: true,&quot;stateMutability&quot;: &quot;payable&quot;,&quot;type&quot;: &quot;function&quot;&#125;,&#123;&quot;inputs&quot;: [],&quot;payable&quot;: false,&quot;stateMutability&quot;: &quot;nonpayable&quot;,&quot;type&quot;: &quot;constructor&quot;&#125;,&#123;&quot;anonymous&quot;: false,&quot;inputs&quot;: [&#123;&quot;indexed&quot;: false,&quot;name&quot;: &quot;addr&quot;,&quot;type&quot;: &quot;address&quot;&#125;],&quot;name&quot;: &quot;SendEther&quot;,&quot;type&quot;: &quot;event&quot;&#125;,&#123;&quot;anonymous&quot;: false,&quot;inputs&quot;: [&#123;&quot;indexed&quot;: false,&quot;name&quot;: &quot;addr&quot;,&quot;type&quot;: &quot;address&quot;&#125;],&quot;name&quot;: &quot;SendFlag&quot;,&quot;type&quot;: &quot;event&quot;&#125;]&#x27;</span></span><br><span class="line">_abi = json.loads(_abi_json)</span><br><span class="line"></span><br><span class="line">w3.geth.personal.unlockAccount(w3.eth.accounts[<span class="number">0</span>], <span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line">BalsnCTFContract = w3.eth.contract(abi=_abi, bytecode=_bytecode)</span><br><span class="line">txHash = BalsnCTFContract.constructor().transact(&#123;<span class="string">&#x27;from&#x27;</span>: w3.eth.accounts[<span class="number">0</span>], <span class="string">&#x27;gas&#x27;</span>: <span class="number">1000000</span>&#125;) <span class="comment"># The &#x27;from&#x27; key states the manager of the contract.</span></span><br><span class="line">txReceipt = w3.eth.waitForTransactionReceipt(txHash)</span><br><span class="line">print(txReceipt)</span><br><span class="line"></span><br><span class="line">bc = w3.eth.contract(address=txReceipt.contractAddress, abi=_abi)</span><br><span class="line">txHash = bc.functions.deposit(<span class="string">b&#x27;thisisahash&#x27;</span>).transact(&#123;<span class="string">&#x27;from&#x27;</span>: w3.eth.accounts[<span class="number">0</span>], <span class="string">&#x27;to&#x27;</span>:w3.eth.accounts[<span class="number">1</span>], <span class="string">&#x27;gas&#x27;</span>: <span class="number">10000000</span>, <span class="string">&#x27;value&#x27;</span>: w3.toWei(<span class="number">97</span>, <span class="string">&#x27;ether&#x27;</span>)&#125;) <span class="comment"># There cannot be too much ether for the transaction, otherwise an error will be reported.</span></span><br><span class="line">txReceipt = w3.eth.waitForTransactionReceipt(txHash)</span><br><span class="line">print(txReceipt)</span><br></pre></td></tr></table></figure>
<p>However if we try to run it, the program seems to be suspended. Remember what we talk about in the previous chapter? Only if there is at least one node minning, the transaction would be handled. So all we need is just to mine one block like this:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">miner.start(1); admin.sleepBlocks(1); miner.stop();</span><br></pre></td></tr></table></figure>
<p>At last the execution result will be like this:</p>
<p><img src="pic3.png"></p>
<p>We can see that after the execution of <code>BalsnCTFContract.constructor()</code>, a <code>contractAddress</code> will be returned for users to locate the contract, and further more, we can use the address to call a function from the contract without deploying the contract again.</p>
<h2><span id="to-be-continued">to be continued…</span></h2></div></article></div></main><footer><div class="paginator"><a href="/2021/04/06/%E8%BD%A6%E8%81%94%E7%BD%91%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95%E5%85%A5%E9%97%A8%E6%80%BB%E7%BB%93/%E8%BD%A6%E8%81%94%E7%BD%91%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95%E5%85%A5%E9%97%A8%E6%80%BB%E7%BB%93/" class="next">NEXT</a></div><div class="copyright"><p>© 2021 <a href="http://example.com">SuperGate</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>